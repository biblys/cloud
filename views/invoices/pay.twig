{% extends 'layout.twig' %}

{% block title %}Paiement de la facture {{ invoice.number }}{% endblock %}

{% block head %}
  <script type="text/javascript" src="/javascripts/stripe.js">
  </script>
{% endblock %}

{% block body %}

  <h1>Paiement</h1>

  <p>Facture nÂ° {{ invoice.number }} pour {{ invoice.customer.name }}</p>

  <form action="/payments/create" method="post">
    <input type="hidden" name="invoiceId" value="{{ invoice._id }}">

    <div>
      {% for card in cards %}
        <input type="radio" name="stripeCard" value="{{ card.id }}" id="{{ card.id }}" required{% if loop.index == 1 %} checked{% endif %}>
        <label class="label-inline" for="{{ card.id }}">{{ card.brand }} **** **** **** {{ card.last4 }} (Exp. {{ card.exp_month }}/{{ card.exp_year }})</label><br>
      {% endfor %}
    </div>

    {% if cards is not empty %}
      <button>Payer {{ invoice.amount|currency }}</button>
    {% endif %}

    <br><br>

  </form>

  <form id="add-card-form" action="/payments/create" method="POST" data-stripe-key="{{ stripePublicKey }}">
    <input type="hidden" name="invoiceId" value="{{ invoice._id }}">

		<div class="form-row">
			<label for="card-element">
				Credit or debit card
			</label>
			<div id="card-element">
				<!-- a Stripe Element will be inserted here. -->
			</div>

			<!-- Used to display Element errors -->
			<div id="card-errors" role="alert"></div>
		</div>

		<button>Submit Payment</button>
  </form>

{% endblock %}
